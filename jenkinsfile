pipeline {
    agent any
    
    environment {
        TOMCAT_USER = 'ec2-user'
        TOMCAT_HOST = '54.147.25.212'
        TOMCAT_DIR = '/opt/tomcat9/webapps'
    }
    
    stages {
        stage('Build') {
            steps {
                bat 'mvn clean package'
                  }
        }
        
            stage('Deploy to Tomcat') {
                steps {
                    sshagent(credentials: ['tomcat-dev']) {
                    // Copy the WAR file to the EC2 instance
                    bat 'scp target/devops-app.war ${TOMCAT_USER}@${TOMCAT_HOST}:${TOMCAT_DIR}'
                    bat 'ssh ${TOMCAT_USER}@${TOMCAT_HOST} /opt/tomcat9/bin/shutdown.sh'
                    bat 'ssh ${TOMCAT_USER}@${TOMCAT_HOST} /opt/tomcat9/bin/startup.sh'
                }
            }
        }
    }
}
